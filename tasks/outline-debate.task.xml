<task id="bmad/sew/tasks/outline-debate.task.xml" name="Outline Debate">
  <objective>Äiá»u hÃ nh má»™t cuá»™c tranh luáº­n giá»¯a cÃ¡c agent chuyÃªn gia Ä‘á»ƒ táº¡o ra má»™t dÃ n Ã½ bÃ i viáº¿t cÃ³ cáº¥u trÃºc, chuáº©n SEO vá»›i full logging.</objective>

  <parameters>
    <param name="topic" type="string" required="true">Chá»§ Ä‘á» chÃ­nh cá»§a cuá»™c tranh luáº­n (vÃ­ dá»¥: "XÃ¢y dá»±ng dÃ n Ã½ cho bÃ i viáº¿t má»›i").</param>
    <param name="approved_ideas" type="string" required="true">Danh sÃ¡ch cÃ¡c Ã½ tÆ°á»Ÿng Ä‘Ã£ Ä‘Æ°á»£c phÃª duyá»‡t Ä‘á»ƒ lÃ m cÆ¡ sá»Ÿ cho dÃ n Ã½.</param>
    <param name="outline_options" type="array" required="true">Danh sÃ¡ch cÃ¡c outline options/structures Ä‘á»ƒ debate.</param>
    <param name="num_rounds" type="number" required="false">Sá»‘ rounds tranh luáº­n (máº·c Ä‘á»‹nh: 2).</param>
    <param name="output_file" type="string" required="false">ÄÆ°á»ng dáº«n file Ä‘á»ƒ lÆ°u full debate transcript (YAML).</param>
  </parameters>

  <output>
    <param name="debate_transcript" type="yaml">Full debate transcript vá»›i táº¥t cáº£ rounds vÃ  exchanges.</param>
    <param name="ranked_outlines" type="array">Outline options Ä‘Ã£ Ä‘Æ°á»£c xáº¿p háº¡ng theo Ä‘iá»ƒm sá»‘.</param>
    <param name="synthesis" type="object">Tá»•ng há»£p insights tá»« debate.</param>
  </output>

  <flow>
    <step n="1" goal="Chuáº©n bá»‹ context vÃ  outline options">
      <action>Format context data:
        ```
        === Approved Ideas ===
        {{approved_ideas}}

        These approved ideas should inform the outline structure.
        Each outline option will be evaluated on how well it incorporates these ideas.
        ```
      </action>

      <action>Set default {{num_rounds}} = 2 if not provided</action>

      <action>Validate {{outline_options}}:
        - Must have at least 2 outline structures to compare
        - Each outline should have: id, title, structure/sections
      </action>

      <action>Log initiation:
        "ğŸ¯ Starting Outline Debate"
        "ğŸ“‹ Topic: {{topic}}"
        "ğŸ“ Outline options: {{outline_options.length}}"
        "ğŸ”„ Rounds planned: {{num_rounds}}"
      </action>
    </step>

    <step n="2" goal="Invoke debate orchestrator with outline-specific criteria">
      <action critical="true">
        Execute debate-orchestrator.task.xml:
        ```
        exec: {project-root}/bmad/sew/tasks/debate-orchestrator.task.xml
        parameters:
          topic: {{topic}}
          debaters: ["ContentAnalyzer", "MarketInsightAgent", "SEOSpecialist", "AdaptiveWriter"]
          scoring_criteria: ["Logical Flow", "SEO Keyword Distribution", "Cultural Flow", "Hook Effectiveness", "Readability"]
          context_data: {{formatted_context}}
          ideas_to_debate: {{outline_options}}
          num_rounds: {{num_rounds}}
          output_file: {{output_file}}
        output_variable: orchestrator_results
        ```
      </action>

      <note>Outline debate criteria differ from ideas debate:
        - Logical Flow: Does structure make sense? Natural progression?
        - SEO Keyword Distribution: Keywords spread effectively across sections?
        - Cultural Flow: Does structure resonate with target culture?
        - Hook Effectiveness: Does opening grab attention?
        - Readability: Is structure easy to scan and navigate?
      </note>
    </step>

    <step n="3" goal="Extract and present results">
      <action>Extract from orchestrator_results:
        - debate_transcript (full YAML)
        - ranked_outlines (sorted by score)
        - synthesis (key insights)
      </action>

      <action>Display summary to user:
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        "âœ… OUTLINE DEBATE COMPLETE"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        ""
        "ğŸ† Top Ranked Outline Structures:"
        For each outline in ranked_outlines (top 3):
          "{{rank}}. {{title}}"
          "   Score: {{total_score}}/{{max}} ({{percentage}}%)"
          "   Consensus: {{consensus_level}}"
          "   Best Criterion: {{top_criterion}}: {{top_score}}"
          "   Structure: {{section_count}} sections"
        ""
        "ğŸ’¡ Key Insights:"
        For each insight in synthesis.key_insights:
          "- {{insight}}"
        ""
        "ğŸ¯ Recommendations:"
        IF top outline has high consensus:
          "Strong consensus on #1 outline - proceed with confidence"
        ELSE:
          "Consider hybrid approach combining strengths from multiple outlines"
        ""
        IF output_file:
          "ğŸ“„ Full transcript saved: {{output_file}}"
      </action>
    </step>

    <step n="4" goal="Return structured output">
      <output>
        <param name="debate_transcript" type="yaml">{{orchestrator_results.debate_transcript}}</param>
        <param name="ranked_outlines" type="array">{{orchestrator_results.ranked_ideas}}</param>
        <param name="synthesis" type="object">{{orchestrator_results.synthesis}}</param>
      </output>
    </step>
  </flow>

  <notes>
    <note>This task uses debate-orchestrator.task.xml with outline-specific criteria</note>
    <note>Outline debate focuses on structure, flow, and SEO distribution</note>
    <note>Full transcript captures agent reasoning about structure choices</note>
    <note>Scoring helps identify strongest outline or opportunities for hybrid approach</note>
    <note>Compatible with human approval gate in main workflow</note>
  </notes>
</task>
